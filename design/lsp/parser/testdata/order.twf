workflow OrderFulfillment(orderId: string) -> (OrderResult):
    signal PaymentReceived(transactionId: string, amount: decimal):
        paymentStatus = "received"
        paymentAmount = amount

    query GetStatus() -> (OrderStatus):
        return OrderStatus{phase: currentPhase, paid: paymentStatus}

    update ChangeAddress(addr: Address) -> (UpdateResult):
        shippingAddress = addr
        return UpdateResult{ok: true}

    activity GetOrder(orderId) -> order

    if (order.priority == "high"):
        activity ExpediteOrder(order)
    else:
        activity StandardProcessing(order)

    await all:
        activity ReserveInventory(order) -> inventory
        activity ProcessPayment(order) -> payment

    hint signal PaymentReceived
    workflow ShipOrder(order) -> shipResult
    return OrderResult{status: "completed"}

workflow ShipOrder(order: Order) -> (ShipResult):
    activity CreateShipment(order) -> shipment
        options(startToCloseTimeout: 30s)
    return shipment
