# Source: testing.md
# Patterns: simple testable workflow/activity pairs

# --- Basic testable order workflow ---

workflow OrderWorkflow(order: Order) -> (OrderResult):
    activity ValidateOrder(order) -> validated
    if (validated.success == false):
        return OrderResult{status: "invalid"}

    activity ProcessPayment(order.payment) -> payment
    activity ShipOrder(order)

    return OrderResult{status: "completed", paymentId: payment.id}

# --- Workflow with timer for testing ---

workflow ReminderWorkflow(userId: string):
    activity SendFirstReminder(userId)

    timer 24h

    activity SendSecondReminder(userId)

    timer 48h

    activity SendFinalReminder(userId)

# --- Workflow with signals for testing ---

workflow ApprovalWorkflow(request: Request) -> (Decision):
    signal Approved(approver: string):
        return Decision{status: "approved", approver: approver}

    signal Rejected(approver: string, reason: string):
        return Decision{status: "rejected", reason: reason}

    activity NotifyApprovers(request)

    hint signal Approved
    hint signal Rejected
    await one:
        timer 1h:
            return Decision{status: "timeout"}

# --- Workflow with query for testing ---

workflow StatusWorkflow(orderId: string) -> (OrderResult):
    query GetStatus() -> (string):
        return status

    status = "pending"
    activity StartProcessing(orderId)

    status = "processing"
    activity ProcessItems(orderId)

    status = "completed"
    return OrderResult{status: status}

# --- Parent-child workflow for testing ---

workflow ParentWorkflow(data: Data) -> (Result):
    workflow ChildWorkflow(data.item) -> childResult
    return Result{childData: childResult}

workflow ChildWorkflow(item: Item) -> (ChildResult):
    activity ProcessItem(item)
    return ChildResult{processed: true}

# --- Supporting activities ---

activity ValidateOrder(order: Order) -> (ValidationResult):
    return validate(order)

activity ProcessPayment(payment: Payment) -> (PaymentResult):
    return charge(payment)

activity ShipOrder(order: Order):
    ship(order)

activity SendFirstReminder(userId: string):
    send_reminder(userId, 1)

activity SendSecondReminder(userId: string):
    send_reminder(userId, 2)

activity SendFinalReminder(userId: string):
    send_reminder(userId, 3)

activity NotifyApprovers(request: Request):
    notify(request.approvers)

activity StartProcessing(orderId: string):
    start(orderId)

activity ProcessItems(orderId: string):
    process_all(orderId)

activity ProcessItem(item: Item):
    process(item)
