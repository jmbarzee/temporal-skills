# Source: testing.md
# Patterns: simple testable workflow/activity pairs

# --- Basic testable order workflow ---

workflow OrderWorkflow(order: Order) -> (OrderResult):
    activity ValidateOrder(order) -> validated
    if (validated.success == false):
        close failed OrderResult{status: "invalid"}

    activity ProcessPayment(order.payment) -> payment
    activity ShipOrder(order)

    close OrderResult{status: "completed", paymentId: payment.id}

# --- Workflow with timer for testing ---

workflow ReminderWorkflow(userId: string):
    activity SendFirstReminder(userId)

    await timer(24h)

    activity SendSecondReminder(userId)

    await timer(48h)

    activity SendFinalReminder(userId)
    close

# --- Workflow with signals for testing ---

workflow ApprovalWorkflow(request: Request) -> (Decision):
    signal Approved(approver: string):
        approved = true
        approverName = approver

    signal Rejected(approver: string, reason: string):
        rejected = true
        rejectReason = reason

    approved = false
    rejected = false
    approverName = ""
    rejectReason = ""

    activity NotifyApprovers(request)

    await one:
        signal Approved:
            close Decision{status: "approved", approver: approverName}
        signal Rejected:
            close failed Decision{status: "rejected", reason: rejectReason}
        timer(1h):
            close Decision{status: "timeout"}

# --- Workflow with query for testing ---

workflow StatusWorkflow(orderId: string) -> (OrderResult):
    query GetStatus() -> (string):
        return status

    status = "pending"
    activity StartProcessing(orderId)

    status = "processing"
    activity ProcessItems(orderId)

    status = "completed"
    close OrderResult{status: status, orderId: orderId}

# --- Supporting activities ---

activity ValidateOrder(order: Order) -> (ValidationResult):
    return validate(order)

activity ProcessPayment(payment: Payment) -> (PaymentResult):
    return charge(payment)

activity ShipOrder(order: Order):
    ship(order)

activity SendFirstReminder(userId: string):
    remind(userId, "first")

activity SendSecondReminder(userId: string):
    remind(userId, "second")

activity SendFinalReminder(userId: string):
    remind(userId, "final")

activity NotifyApprovers(request: Request):
    notify(request.approvers)

activity StartProcessing(orderId: string):
    start(orderId)

activity ProcessItems(orderId: string):
    process(orderId)
